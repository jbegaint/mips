#include <stdio.h>#include <stdlib.h>#include <math.h>#include <string.h>#include "arch/arch.h"#include "desc/desc.h"#include "instr/parser_instru.h"#include "instr/affiche_instru.h"#include "notify.h"extern int DESC_ARRAY_LENGTH;extern DESC* DESC_ARRAY;int display_instr(uint val){    int c;    uint opcode, function;    opcode = parser_instr(val, 26, 31);    if (opcode == 0){        function = parser_instr(val, 0, 5);        c = matchR(function);        if (c == NO_MATCH)            return 0;        display_typeR(c, val);    }    else {        c = matchJI(opcode);        if (c == NO_MATCH)            return 0;        if ( DESC_ARRAY[c].type == 'I' )            display_typeI(c,val);        else            display_typeJ(c,val);    }    return 1;}int display_typeR(int c, uint val){    uchar B;    uint rs, rt, rd, sa;    parser_typeR(val, &rs, &rt, &rd, &sa);    switch (DESC_ARRAY[c].function){        case 32: case 36 : case 37: case 42: case 34: case 38: //ADD AND OR SLT SUB XOR        	fprintf(stdout,"%s $%u, $%u, $%u\n",DESC_ARRAY[c].name, rd, rs, rt);       		break;        case 26: case 24: //DIV MULT        	fprintf(stdout,"%s $%u, $%u\n",DESC_ARRAY[c].name, rs, rt);        	break;        case 16: case 18: //MFHI MFLO        	fprintf(stdout,"%s $%u \n",DESC_ARRAY[c].name, rd);        	break;        case 8: //JR        	fprintf(stdout,"%s $%u \n",DESC_ARRAY[c].name, rs);        	break;        case 2: //RTOR SRL       		B = parser_instr(val, 21, 21);        	if (B == 1)           		fprintf(stdout,"RTOR $%u, $%u, $%u\n",rd, rt, sa);        	else            	fprintf(stdout,"SRL $%u ,$%u ,$%u\n",rd, rt, sa);       		break;        case 0: //SLL NOP	        if (rs == 0 && rt == 0 && rd == 0 && sa == 0)        	    fprintf(stdout,"NOP\n");        	else        	    fprintf(stdout,"%s $%u, $%u, $%u\n",DESC_ARRAY[c].name, rd, rt, sa);        	break;        case 12:            fprintf(stdout, "%s\n", "syscall");            break;        default :      	 	fprintf(stderr,"erreur function inexistant\n");      		return -1;    }    return 1;}int display_typeI(int c, uint val){    uint rs;    uint rt;    uint immediate;    parser_typeI(val, &rs, &rt, &immediate);    switch (DESC_ARRAY[c].opcode) {        case 8: //ADDI       		fprintf(stdout,"%s $%u, $%u, %u\n", DESC_ARRAY[c].name, rt, rs, immediate);        	break;        case 4: case 5: //BEQ BNE        	fprintf(stdout,"%s $%u, $%u, %u\n", DESC_ARRAY[c].name, rs, rt, immediate);        	break;        case 7: case 6: //BGTZ BLEZ        	fprintf(stdout,"%s $%u, %u\n", DESC_ARRAY[c].name, rs, immediate);        	break;        case 15: //LUI        	fprintf(stdout,"%s $%u, 0x%x\n", DESC_ARRAY[c].name, rt, immediate);        	break;        case 35: case 43: //LW SW        	fprintf(stdout,"%s $%u, %u($%u)\n", DESC_ARRAY[c].name, rt, immediate, rs);        	break;        default :        	fprintf(stderr,"erreur opcode inexistant\n");        	return -1;    }    return 1;}int display_typeJ(int c, uint val){    uint target;    parser_typeJ(val, &target);    fprintf(stdout,"%s %u\n", DESC_ARRAY[c].name, target);    return 1;}int matchJI(uint opcode){	for (int i = 0 ; i < DESC_ARRAY_LENGTH; i++)        if ((DESC_ARRAY+i)->opcode == opcode)            return i;    return NO_MATCH;}int matchR(uint function){	for (int i = 0 ; i < DESC_ARRAY_LENGTH; i++)		if ((DESC_ARRAY+i)->function == function)            return i;    return NO_MATCH;}